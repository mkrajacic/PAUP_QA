@using QA.Models
@using QA.Misc
@model MixModel
@{
    ViewBag.Title = "QBox";
    Layout = "~/Views/Shared/_Layout.cshtml";
    AjaxOptions ajaxOpt = new AjaxOptions()
    {
        UpdateTargetId = "questionList",
        InsertionMode = InsertionMode.Replace,
        HttpMethod = "GET",
        OnBegin = "LoadingRow"
    };
}
<div class="search-section" id="pretrazivanje">
    <div class="search-box">
        @using (Ajax.BeginForm("Pretrazivanje", "App", ajaxOpt))
        {
            @Html.TextBox("pitanjeTekst", null, new { @class = "search-input", @placeholder = "Što želite saznati?" })
            @Html.DropDownList("kategorija", new SelectList(Model.Kategorije.Select(x => x.kategorija)), "Odaberi kategoriju")
            <button type="submit" class="search-btn">Traži...</button>
        }
    </div>
</div>

<div class="question-container" id="questionList">
    <div class="category-name">Najnovija pitanja</div>
    <div class="questions">
        @foreach (var pit in Model.Pitanja.Take(10))
        {
            <div class="question-box">
                <div class="question-text">
                    @if (!String.IsNullOrEmpty(pit.pitanjeTekst))
                    {
                        @Html.ActionLink(pit.pitanjeTekst, "OtvoriPitanje", new { id = pit.id }, new { @id = "pitanjeDetalji", @data_url = Url.Action("OtvoriPitanje", "App", new { id = pit.id }) })

                    }
                </div>
                <p class="answers-num">
                    Odgovora:
                    @if (Model.Odgovori.Where(x => x.pitanje_id == pit.id).Count() != 0)
                    {
                        <div class="num">@Model.Odgovori.Where(x => x.pitanje_id == pit.id).Count()</div>
                    }
                    else
                    {
                        <div class="num" style="background-color:#c0392b;">0</div>
                    }
                </p>
            </div>
        }
    </div>
</div>

<div class="category-container">
    <div class="row">
        @foreach (var kat in Model.Kategorije)
        {
            <div class="category"><p>@Ajax.ActionLink(kat.kategorija, "OtvoriKategoriju", new { id = kat.id }, ajaxOpt, new { @id = "kategorijaPrikaz", @data_url = Url.Action("OtvoriKategoriju", "App", new { id = kat.id }) })</p></div>
        }
    </div>
</div>
@*<div class="modal" id="modalView" tabindex="-1" role="dialog" aria-labelledby="modalView" aria-hidden="true" data-backdrop="static">
    <div id="viewContainer">

    </div>
</div>*@
@*<script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    @Styles.Render("/Content/style.css")*@
<script type="text/javascript">
    function LoadingRow() {
        $("#questionList").empty();

        $("#questionList").append('<div class="question-box"><div class="question-text">Pretraga u tijeku...</div></div>');

        // $("#pager").empty();
    }
</script>
@*<script type="text/javascript">
    $('.question-text').on("click", "#pitanjeDetalji", function (event) {
        event.preventDefault();

        var url = $(this).attr("data-url");
        $.get(url, function (data) {
            $('#viewContainer').html(data);
            $('#modalView').modal('show');
        });
    });
</script>*@


